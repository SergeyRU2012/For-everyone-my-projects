def input_digit(text_func, exception_func=None, error_func="Вы ввели не правильные данные! Попробуйте снова."):
    while True:
        user_input = input(text_func)
        if user_input == "":
            print(error_func)
            print()
            continue

        for index in range(len(user_input)):
            if (not user_input[index].isdigit() and user_input[index] != exception_func and
                    (user_input[index] != "-" or (not user_input[index + (index != len(user_input) - 1)].isdigit()))):
                print(error_func)
                print()
                break
        else:
            return user_input


def max_element_matrix(matrix_func):
    return max([max([len(str(symbol)) for symbol in line]) for line in matrix_func])


def unpacking_matrix(matrix_func):
    indentation = max_element_matrix(matrix_func)

    for line in matrix_func:
        for symbol in line:
            print(str(symbol).ljust(indentation + 1), end="")
        print()


def create_matrix(text1_func, text2_func):
    matrix_func = []
    while True:
        rows, cols = int(input_digit(text1_func, " ")), int(input_digit(text2_func, " "))
        if rows > 0 and cols > 0:
            break
        print("Введено значение меньше 1! Попробуйте снова.\n")
    print()

    for index in range(rows):
        while True:
            line = input_digit(f"Введите строку {index + 1} из {rows} строк: ", " ").split()
            if len(line) == cols:
                matrix_func.append([int(symbol) for symbol in line])
                break
            print(f"Неверное количество элементов! Их должно быть: {cols}\n")
    print()
    return matrix_func


def sum_matrices(matrix1_func, matrix2_func):
    rows, cols = len(matrix1_func), len(matrix1_func[0])

    if rows == len(matrix2_func) and cols == len(matrix2_func[0]):
        return [[matrix1_func[i][j] + matrix2_func[i][j] for j in range(cols)] for i in range(rows)]
    print("Размерность матриц не одинакова! Попробуйте снова.")


def subtraction_matrices(matrix1_func, matrix2_func):
    rows, cols = len(matrix1_func), len(matrix1_func[0])

    if rows == len(matrix2_func) and cols == len(matrix2_func[0]):
        return [[matrix1_func[i][j] - matrix2_func[i][j] for j in range(cols)] for i in range(rows)]
    print("Размерность матриц не одинакова! Попробуйте снова.")


def multiplication_matrices(matrix1_func, matrix2_func):
    matrix1_rows, matrix2_rows = len(matrix1_func), len(matrix2_func)

    if len(matrix1_func[0]) == matrix2_rows:
        return [[sum([matrix2_func[i][fixed_j] * matrix1_func[index][i] for i in range(matrix2_rows)])
                 for fixed_j in range(matrix1_rows)] for index in range(matrix1_rows)]
    print("количество столбцов 1 матрицы должны совпадать с количеством строк 2 матрицы! Попробуйте снова.")


def transposition_matrices(matrix_func):
    rows, cols = len(matrix_func), len(matrix_func[0])
    return [[matrix_func[i][j] for i in range(rows)] for j in range(cols)]


def input_matrix(kit_matrices_func, num_input_func):
    count_matrices = len(kit_matrices_func)
    while True:
        user_way = input("Вы хотите создать матрицу или выбрать уже существующую? Введите способ(создать, выбрать): ").lower()
        if "выбрать" in user_way or "создать" in user_way:
            break
        print("Ведённый вами способ не существует! Попробуйте снова.\n")

    if "выбрать" in user_way and count_matrices:
        for index_matrix in range(len(kit_matrices_func)):
            unpacking_matrix(kit_matrices_func[index_matrix])
            print(f"- - - - - {index_matrix + 1}")
        while True:
            index = int(input_digit("Введите номер матрицы: "))
            if 0 < index < count_matrices + 1:
                break
            print("введённого вами номера матрицы не существует! Попробуйте снова.")
        return kit_matrices_func[index - 1]
    else:
        if "выбрать" in user_way:
            print("Вы не можете выбрать матрицу поскольку до этого не было сделана операций! Предлагаем создать её.\n")
        return create_matrix(f"Введите количество строк {num_input_func} матрицы:",
                             f"Введите количество столбцов {num_input_func} матрицы:")


def calculation_result(matrices_func):
    while True:
        while True:
            operation = input("Введите желаемую операцию(вычитание, сложение, умножение, транспортирование): ").lower()
            if "вычитание" in operation or "сложение" in operation or "умножение" in operation or "транспортирование" in operation:
                break
            print("Введена неизвестная операция! Попробуйте снова.\n")

        matrix1 = input_matrix(matrices_func, 1)

        if "транспортирование" in operation:
            result_operation = transposition_matrices(matrix1)
            if result_operation is None:
                continue
            return result_operation

        matrix2 = input_matrix(matrices_func, 2)

        if "вычитание" in operation:
            result_operation = subtraction_matrices(matrix1, matrix2)
        elif "сложение" in operation:
            result_operation = sum_matrices(matrix1, matrix2)
        else:
            result_operation = multiplication_matrices(matrix1, matrix2)

        if result_operation is None:
            continue
        return result_operation


# основная часть кода
kit_matrices = []
while True:
    result = calculation_result(kit_matrices)
    kit_matrices.append(result)
    unpacking_matrix(result)
